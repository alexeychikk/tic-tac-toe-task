<!DOCTYPE html>
<html>
  <head>
    <title>Parcel Sandbox</title>
    <meta charset="UTF-8" />

    <style>
      html {
        height: 100%;
      }
      body {
        font-family: sans-serif;
        height: 100%;
      }

      #app {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%;
      }

      .field {
        user-select: none;
      }

      .row {
        display: flex;
      }

      .col {
        width: 50px;
        height: 50px;
        border: 2px solid gray;
        display: flex;
        font-size: 36px;
        font-weight: 700;
        justify-content: center;
        align-items: center;
      }
      .col:not(.filled) {
        cursor: pointer;
      }
      .col:hover:not(.filled) {
        background-color: #ccff90;
      }

      .col > * {
        line-height: 1;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21"></script>
  </head>

  <body>
    <div id="app"></div>
    <div id="win"></div>

    <script>
      const fieldSize = 3;

      // –¢—É—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–ª—è, –ø–æ–∫–∞ –Ω–µ –≤–¥–∞–≤–∞–π—Å—è –≤ –¥–µ—Ç–∞–ª–∏
      // —Ö–æ—Ç—è —Ç—É—Ç –Ω–∏—á–µ–≥–æ —Å–ª–æ–∂–Ω–æ–≥–æ, –µ—Å–ª–∏ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è
      document.getElementById("app").innerHTML = `
      <div class="field">
        ${_.times(
          fieldSize,
          (i) => `
        <div class="row" id="row${i}">
          ${_.times(
            fieldSize,
            (j) => `<div class="col" id="col${i * fieldSize + j}"></div>`
          ).join("")}
        </div>`
        ).join("")}
      </div>
      `;

      // –¢—É—Ç —è –±–µ—Ä—É –∫–∞–∂–¥—É—é –∫–ª–µ—Ç–∫—É –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é —Å–æ–±—ã—Ç–∏–µ —á—Ç–æ–±—ã
      // –ø–æ –Ω–∞–∂–∞—Ç–∏—é –õ–ö–ú –ø–æ –∫–ª–µ—Ç–∫–µ –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å —Ñ—É–Ω–∫—Ü–∏—è
      // —Ç–æ–∂–µ –ø–æ–∫–∞ –Ω–µ –≤–¥–∞–≤–∞–π—Å—è –≤ –¥–µ—Ç–∞–ª–∏
      _.times(fieldSize * fieldSize, (i) => {
        const cellEl = document.getElementById(`col${i}`);
        cellEl.onclick = () => handleCellClick(i, cellEl.dataset.fillSign);
      });

      // –í–æ—Ç —Ç—É—Ç —É–∂–µ –ø—Ä–∏–¥—ë—Ç—Å—è —Ç–µ–±–µ –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å.
      // üëáüëáüëáüëáüëáüëáüëáüëáüëáüëáüëáüëáüëáüëáüëáüëáüëáüñïüëáüëáüëá
      /**
       * –ù–µ –ø—É–≥–∞–π—Å—è —Ç–∞–∫–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è. –≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è JSDoc. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç
       * –¥–æ–±–∞–≤–ª—è—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º —Ñ—É–Ω–∫—Ü–∏–π –∏ —Ç.–ø.
       * –Ø –∑–¥–µ—Å—å –æ–ø–∏—à—É, —á—Ç–æ –∑–Ω–∞—á–∏—Ç –∫–∞–∂–¥—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä, —á—Ç–æ–±—ã —Ç—ã –ø–æ–Ω–∏–º–∞–ª,
       * –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π –∏ —á—Ç–æ –≤ –∏—Ç–æ–≥–µ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å.
       * –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ —Ç—ã –∫–ª–∏–∫–∞–µ—à—å –ª–µ–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –ø–æ –∫–ª–µ—Ç–∫–µ.
       * –ö–æ–≥–¥–∞ —Ç—ã –∫–ª–∏–∫–∞–µ—à—å, —è –ø–µ—Ä–µ–¥–∞—é –≤ —Ñ—É–Ω–∫—Ü–∏—é 3 –ø–∞—Ä–∞–º–µ—Ç—Ä–∞, –≤ –∫–æ—Ç–æ—Ä—ã—Ö —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è
       * –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–µ—Ç–∫–µ, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é —Ç—ã –Ω–∞–∂–∞–ª:
       * @param {Number} cellIndex - —ç—Ç–æ –∏–Ω–¥–µ–∫—Å –∫–ª–µ—Ç–∫–∏, –æ—Ç 0 –¥–æ 8, –µ—Å–ª–∏ —Å—á–∏—Ç–∞—Ç—å
       * —Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑, —Ç–æ –µ—Å—Ç—å
       * –≤–µ—Ä—Ö–Ω—è—è –ª–µ–≤–∞—è –∫–ª–µ—Ç–∫–∞ 0,
       * –≤–µ—Ä—Ö–Ω—è—è –ø—Ä–∞–≤–∞—è 2,
       * –Ω–∏–∂–Ω—è—è –ª–µ–≤–∞—è 6,
       * –Ω–∏–∂–Ω—è—è –ø—Ä–∞–≤–∞—è 8
       * @param {String} fillSign - —ç—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —É–∂–µ —Å—Ç–æ–∏—Ç
       * –≤ –∫–ª–µ—Ç–∫–µ - –∫—Ä–µ—Å—Ç–∏–∫ –∏–ª–∏ –Ω–æ–ª–∏–∫ –∏–ª–∏ –ø—É—Å—Ç–æ. –ï—Å–ª–∏ —Ç–∞–º –∫—Ä–µ—Å—Ç–∏–∫ –∏–ª–∏ –Ω–æ–ª–∏–∫ -
       * —Ç–æ —Ç–∏–ø–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞ "X" –∏–ª–∏ "O", –µ—Å–ª–∏ –ø—É—Å—Ç–æ - undefined.
       */

      //function handleCellClick(cellIndex, fillSign) {
      // –¢–µ–±–µ –Ω—É–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
      // –Ø —Ö–æ—á—É, —á—Ç–æ–±—ã –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –∏–≥—Ä–æ–∫ –Ω–∞–∂–∏–º–∞–µ—Ç –Ω–∞ –ø—É—Å—Ç—É—é –∫–ª–µ—Ç–∫—É
      // —Å—Ç–∞–≤–∏–ª—Å—è –∫—Ä–µ—Å—Ç–∏–∫, –ø–æ—Å–ª–µ —á–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–æ–º —Å—Ç–∞–≤–∏–ª
      // –Ω–æ–ª–∏–∫ –≤ –ª—é–±—É—é –Ω–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—É—é –∫–ª–µ—Ç–∫—É.
      // –ù—É –∏ —Ç–∞–∫, –ø–æ–∫–∞ –∫—Ç–æ-—Ç–æ –Ω–µ –≤—ã–∏–≥—Ä–∞–µ—Ç - –∏–≥—Ä–æ–∫, –ª–∏–±–æ –∫–æ–º–ø—å—é—Ç–µ—Ä, –ª–∏–±–æ
      // –Ω–∏—á—å—è.
      // –¢—ã –º–æ–∂–µ—à—å –æ–±—ä—è–≤–ª—è—Ç—å —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –≥–¥–µ —É–≥–æ–¥–Ω–æ.
      // –í–æ–æ–±—â–µ, —ç–∫—Å–ø–µ—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–π —Å —ç—Ç–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–æ–π –∫–∞–∫ —Ö–æ—á–µ—à—å.
      // –ì–ª–∞–≤–Ω–æ–µ, —á—Ç–æ–±—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—ã–ª.
      //}

      /**
       * –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø–æ–ª–Ω—è–µ—Ç –∫–ª–µ—Ç–∫—É –∑–Ω–∞—á–µ–Ω–∏–µ–º.
       * –î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, –µ—Å–ª–∏ –ø–æ –Ω–∞–∂–∞—Ç–∏—é –Ω–∞ –∫–ª–µ—Ç–∫—É —Ç—ã —Ö–æ—á–µ—à—å,
       * —á—Ç–æ–±—ã –≤ –Ω–µ—ë –ø–æ—Å—Ç–∞–≤–∏–ª—Å—è –∫—Ä–µ—Å—Ç–∏–∫, —Ç—ã –≤—ã–∑—ã–≤–∞–µ—à—å fill(4, "X").
       * –ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ, —Ç—ã —Ç—É–¥–∞ –º–æ–∂–µ—à—å –ø–µ—Ä–µ–¥–∞—Ç—å —á—Ç–æ —É–≥–æ–¥–Ω–æ, —Ö–æ—Ç—å fill(0, "Z")
       * –∏ —Å–¥–µ–ª–∞—Ç—å –≤–º–µ—Å—Ç–æ –∫—Ä–µ—Å—Ç–∏–∫–æ–≤ –Ω–æ–ª–∏–∫–æ–≤ —Å–≤–æ—é –∏–≥—Ä—É —Å "Y", "Z", –±–ª–µ–∫ –¥–∂–µ–∫–æ–º
       * –∏ —à–ª—é—Ö–∞–º–∏.
       * @param {Number} cellIndex - —ç—Ç–æ –∏–Ω–¥–µ–∫—Å –∫–ª–µ—Ç–∫–∏
       * @param {String} sign - —á–µ–º –∑–∞–ø–æ–ª–Ω–∏—Ç—å –∫–ª–µ—Ç–∫—É, –∫—Ä–µ—Å—Ç–∏–∫–æ–º –∏–ª–∏ –Ω–æ–ª–∏–∫–æ–º
       */
      function fill(cellIndex, sign) {
        const cellEl = document.getElementById(`col${cellIndex}`);
        cellEl.classList.add("filled");
        cellEl.dataset.fillSign = sign;
        cellEl.innerHTML = `<div>${sign}</div>`;
      }
      const cellsValues = [
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
      ];
      // function handleCellClick(cellIndex, fillSign) {
      //   if (fillSign !== undefined) {
      //     return;
      //   }
      //   fill(cellIndex, "X");
      //   cellsValues[cellIndex] = "X";
      //   const emptyCellIndexes = cellsValues.map(function (el, index) {
      //     if (el === undefined) {
      //       return index;
      //     } else {
      //     }
      //   });
      // let randomCellIndex = Math.floor(Math.random() * cellsValues.length);
      // if (cellsValues[randomCellIndex] === undefined) {
      //   fill(randomCellIndex, "0");
      //   cellsValues[randomCellIndex] = "0";
      //   break;
      // }
      // if (cellsValues.every((elem) => elem !== undefined)) {
      //   break;
      // }
      // }
      let winner;
      function handleCellClick(cellIndex, fillSign) {
        if (winner !== undefined) {
          return;
        }
        if (fillSign === undefined) {
          fill(cellIndex, "X");
          cellsValues[cellIndex] = "X";
          announceWinner();
          if (cellsValues.every((elem) => elem !== undefined)) {
            return;
          }
          while (true) {
            let randomCellIndex = Math.floor(
              Math.random() * cellsValues.length
            );
            if (cellsValues[randomCellIndex] === undefined) {
              fill(randomCellIndex, "0");
              cellsValues[randomCellIndex] = "0";
              announceWinner();
              break;
            }
          }
        }
      }
      function announceWinner() {
        winner = getWinner(cellsValues);
        if (winner !== undefined) {
          if (winner !== "draw") {
            return console.log(winner + " win");
          }
          return console.log("draw");
        }
      }
      function getWinner(arr) {
        if (
          (arr[0] === "X" && arr[1] === "X" && arr[2] === "X") ||
          (arr[3] === "X" && arr[4] === "X" && arr[5] === "X") ||
          (arr[6] === "X" && arr[7] === "X" && arr[8] === "X") ||
          (arr[0] === "X" && arr[3] === "X" && arr[6] === "X") ||
          (arr[1] === "X" && arr[4] === "X" && arr[7] === "X") ||
          (arr[2] === "X" && arr[5] === "X" && arr[8] === "X") ||
          (arr[2] === "X" && arr[4] === "X" && arr[6] === "X") ||
          (arr[0] === "X" && arr[4] === "X" && arr[8] === "X")
        ) {
          return "X";
        }
        if (
          (arr[0] === "0" && arr[1] === "0" && arr[2] === "0") ||
          (arr[3] === "0" && arr[4] === "0" && arr[5] === "0") ||
          (arr[6] === "0" && arr[7] === "0" && arr[8] === "0") ||
          (arr[0] === "0" && arr[3] === "0" && arr[6] === "0") ||
          (arr[1] === "0" && arr[4] === "0" && arr[7] === "0") ||
          (arr[2] === "0" && arr[5] === "0" && arr[8] === "0") ||
          (arr[2] === "0" && arr[4] === "0" && arr[6] === "0") ||
          (arr[0] === "0" && arr[4] === "0" && arr[8] === "0")
        ) {
          return "0";
        }
        if (cellsValues.every((elem) => elem !== undefined)) {
          return "draw";
        }
      }
    </script>
  </body>
</html>
